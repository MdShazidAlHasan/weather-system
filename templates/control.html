<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Window Control Panel</title>
    <link rel="stylesheet" href="/static/control.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <!-- Floating particles -->
    <div class="particle" style="width: 10px; height: 10px; top: 20%; left: 10%;"></div>
    <div class="particle" style="width: 15px; height: 15px; top: 60%; left: 80%; animation-delay: 2s;"></div>
    <div class="particle" style="width: 8px; height: 8px; top: 80%; left: 20%; animation-delay: 4s;"></div>
    <div class="particle" style="width: 12px; height: 12px; top: 40%; left: 70%; animation-delay: 1s;"></div>

    <header>
        <div class="header-content">
            <i class="fas fa-sliders-h"></i>
            <span>Window Control Panel</span>
        </div>
    </header>

    <main>
        <div class="control-container">
            <h2 class="control-title">Window Control</h2>

            <div class="window-status">
                <div class="status-label">Current Status</div>
                <div class="status-text" id="window-status">
                    <div class="loading"></div>
                    <span>Loading...</span>
                </div>
            </div>

            <div id="message" class="message"></div>

            <div class="control-buttons">
                <button class="control-btn btn-open" id="btn-open" onclick="openWindow()">
                    <i class="fas fa-chevron-up"></i>
                    <span>Open Window</span>
                </button>
                <button class="control-btn btn-close" id="btn-close" onclick="closeWindow()">
                    <i class="fas fa-chevron-down"></i>
                    <span>Close Window</span>
                </button>
            </div>
            <div class="control-buttons" style="margin-top: 1rem;">
                <button class="control-btn btn-warning" id="btn-buzzer-on" onclick="activateBuzzer()"
                    style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);">
                    <i class="fas fa-bell"></i>
                    <span>Buzzer ON</span>
                </button>
                <button class="control-btn btn-info" id="btn-buzzer-off" onclick="deactivateBuzzer()"
                    style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                    <i class="fas fa-bell-slash"></i>
                    <span>Buzzer OFF</span>
                </button>
            </div>

            <div class="back-button">
                <button onclick="location.href='/'">
                    <i class="fas fa-home"></i>
                    Back to Dashboard
                </button>
            </div>
            <!-- Add this right after the back-button div in control.html -->
            <div style="text-align: center; margin-top: 1rem;">
                <button onclick="location.href='/video'" style="
        padding: 0.625rem 1.75rem;
        font-size: 0.9rem;
        font-weight: 600;
        background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(168, 85, 247, 0.5);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;">
                    <i class="fas fa-video"></i>
                    Camera Feed
                </button>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 Micro Controller Project| Smart Home Monitoring System</p>
    </footer>

    <script>
        // Get current window status when page loads
        async function updateStatus() {
            try {
                const response = await fetch('/control/status');
                const data = await response.json();

                const statusElement = document.getElementById('window-status');

                if (data.status === 'success') {
                    const isOpen = data.window_status === 'Open';
                    const icon = isOpen ? 'fa-lock-open' : 'fa-lock';
                    const colorClass = isOpen ? 'status-open' : 'status-closed';

                    statusElement.innerHTML = `
                        <i class="fas ${icon}"></i>
                        <span>${data.window_status}</span>
                    `;
                    statusElement.className = `status-text ${colorClass}`;
                } else {
                    statusElement.innerHTML = '<span>Unknown</span>';
                    showMessage('Error getting status: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error fetching status:', error);
                document.getElementById('window-status').innerHTML = '<span>Error</span>';
                showMessage('Failed to get window status', 'error');
            }
        }

        // Open window function
        async function openWindow() {
            const btn = document.getElementById('btn-open');
            const originalContent = btn.innerHTML;

            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = `
                <div class="loading"></div>
                <span>Opening...</span>
            `;

            try {
                const response = await fetch('/control/open', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.status === 'success') {
                    showMessage('✓ ' + data.message, 'success');
                    await updateStatus();
                } else {
                    showMessage('✗ Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error opening window:', error);
                showMessage('✗ Failed to open window', 'error');
            } finally {
                // Re-enable button
                btn.disabled = false;
                btn.innerHTML = originalContent;
            }
        }

        // Close window function
        async function closeWindow() {
            const btn = document.getElementById('btn-close');
            const originalContent = btn.innerHTML;

            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = `
                <div class="loading"></div>
                <span>Closing...</span>
            `;

            try {
                const response = await fetch('/control/close', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.status === 'success') {
                    showMessage('✓ ' + data.message, 'success');
                    await updateStatus();
                } else {
                    showMessage('✗ Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error closing window:', error);
                showMessage('✗ Failed to close window', 'error');
            } finally {
                // Re-enable button
                btn.disabled = false;
                btn.innerHTML = originalContent;
            }
        }

        async function activateBuzzer() {
            const btn = document.getElementById('btn-buzzer-on');
            const originalContent = btn.innerHTML;

            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div><span>Activating...</span>';

            try {
                const response = await fetch('/control/buzzer/on', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.status === 'success') {
                    showMessage('✓ ' + data.message, 'success');
                } else {
                    showMessage('✗ Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage('✗ Failed to activate buzzer', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalContent;
            }
        }

        async function deactivateBuzzer() {
            const btn = document.getElementById('btn-buzzer-off');
            const originalContent = btn.innerHTML;

            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div><span>Deactivating...</span>';

            try {
                const response = await fetch('/control/buzzer/off', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.status === 'success') {
                    showMessage('✓ ' + data.message, 'success');
                } else {
                    showMessage('✗ Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage('✗ Failed to deactivate buzzer', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalContent;
            }
        }
        // Show message function
        function showMessage(text, type) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = text;
            messageElement.className = 'message ' + type;
            messageElement.style.display = 'block';

            // Hide message after 3 seconds
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 3000);
        }

        // Update status every 2 seconds
        updateStatus();
        setInterval(updateStatus, 2000);
    </script>
</body>

</html>